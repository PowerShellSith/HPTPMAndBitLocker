<!doctype html>
<html>
  <head>
    <meta charset="utf-8">
    <meta http-equiv="X-UA-Compatible" content="chrome=1">
    <title>HPTPMAndBitLocker by dotps1</title>

    <link rel="stylesheet" href="stylesheets/styles.css">
    <link rel="stylesheet" href="stylesheets/pygment_trac.css">
    <meta name="viewport" content="width=device-width, initial-scale=1, user-scalable=no">
    <!--[if lt IE 9]>
    <script src="//html5shiv.googlecode.com/svn/trunk/html5.js"></script>
    <![endif]-->
  </head>
  <body>
    <div class="wrapper">
      <header>
        <h1>HPTPMAndBitLocker</h1>
        <p>Custom Powershell Module to ease TPM and BitLocker Administration for HP Workstations</p>

        <p class="view"><a href="https://github.com/dotps1/HPTPMAndBitLocker">View the Project on GitHub <small>dotps1/HPTPMAndBitLocker</small></a></p>


        <ul>
          <li><a href="https://github.com/dotps1/HPTPMAndBitLocker/zipball/master">Download <strong>ZIP File</strong></a></li>
          <li><a href="https://github.com/dotps1/HPTPMAndBitLocker/tarball/master">Download <strong>TAR Ball</strong></a></li>
          <li><a href="https://github.com/dotps1/HPTPMAndBitLocker">View On <strong>GitHub</strong></a></li>
        </ul>
      </header>
      <section>
        <h3>
<a id="this-module-has-the-ability-to-modify-bios-settings-use-at-your-own-risk" class="anchor" href="#this-module-has-the-ability-to-modify-bios-settings-use-at-your-own-risk" aria-hidden="true"><span class="octicon octicon-link"></span></a><em>THIS MODULE HAS THE ABILITY TO MODIFY BIOS SETTINGS USE AT YOUR OWN RISK</em>
</h3>

<p><strong>Highly customized BitLocker PowerShell Module for TPM Administration and BitLocker Administration for HP Workstations.</strong></p>

<p>I have found the "MangeBde.exe" CLI tool a little cumbersome, so I am developing a "More Powerful" BitLocker  PowerShell Module.
Also, the BiosConfigurationUtility from HP is even more cumbersome to manage TPM, with the verbiage being slightly different between models, I need model specific configuration files for every pc I manage to activate and enable TPM.</p>

<p>This Modules contains the following Functions:</p>

<ul>
<li>Get-HPBiosSetupPasswordIsSet</li>
<li>Set-HPBiosSetupPassword</li>
<li>Test-HPTPMEnabledAndActivated </li>
<li>Invoke-HPTPM</li>
<li>Get-BitLockerStatus</li>
<li>Invoke-BitLockerWithTPMAndNumricalKeyProtectors</li>
<li>Get-UnEncryptedWorkstationsFromCMDB</li>
</ul>

<p>The first two functions are more for internal use of the module, the three HP tailored functions are <em>-HP</em> are tailored specifically for HP BIOS and TPM administration, essentially replacing the BiosConfigurationUtility usage TPM.  The remaining functions can be used on any workstation.</p>

<div class="highlight highlight-PowerShell"><pre><span class="pl-c"># Configure TPM on HP Models:</span>
<span class="pl-k"><span class="pl-k">Import-Module</span></span> .\HPTpmAndBitLocker.psm1
<span class="pl-c"># Current Setup Password, if there is not a current password, one will randomly be generated, and removed after configuration completes.</span>
<span class="pl-c"># A Setup Password is required for pragmatically modifying the BIOS.</span>
<span class="pl-vo">$password</span> <span class="pl-k">=</span> <span class="pl-s1"><span class="pl-pds">"</span><span class="pl-pds">"</span></span>

<span class="pl-k">if</span> (<span class="pl-k">-not</span> (<span class="pl-k"><span class="pl-k">Test-HPTPMEnabledAndActivated</span></span>))
{
    <span class="pl-k">if</span>(<span class="pl-k">-not</span>(<span class="pl-k"><span class="pl-k">Get-HPBiosSetupPasswordIsSet</span></span>))
    {
        <span class="pl-vo">$password</span> <span class="pl-k">=</span> powershell <span class="pl-s1"><span class="pl-pds">"</span>. .\Scripts\New-RandomPassword.ps1; New-RandomPassword -Length 14 -Lowercase -Uppercase -Numbers<span class="pl-pds">"</span></span>
        <span class="pl-vo">$randomPasswordUsed</span> <span class="pl-k">=</span> <span class="pl-vo">$true</span>
        <span class="pl-k"><span class="pl-k">Set-HPBiosSetupPassword</span></span> <span class="pl-k">-</span>NewPassword <span class="pl-vo">$password</span>
    }

    <span class="pl-k"><span class="pl-k">Invoke-HPTPM</span></span> <span class="pl-k">-</span>Password <span class="pl-vo">$password</span>

    <span class="pl-k">if</span> (<span class="pl-vo">$randomPasswordUsed</span>)
    {
        <span class="pl-k"><span class="pl-k">Set-HPBiosSetupPassword</span></span> <span class="pl-k">-</span>NewPassword <span class="pl-s1"><span class="pl-pds">"</span> <span class="pl-pds">"</span></span> <span class="pl-k">-</span>CurrentPassword <span class="pl-vo">$password</span>
    }
}</pre></div>

<p>I have included a function in this module that will get unencrypted PCs from a SCCM database so you can foreach the value on the systems and enforce BDE.</p>

<div class="highlight highlight-PowerShell"><pre><span class="pl-k"><span class="pl-k">Import-Module</span></span> HPTPMAndBitLocker
[String[]]<span class="pl-vo">$unEncryptedWorkStations</span> <span class="pl-k">=</span> (<span class="pl-k"><span class="pl-k">Get-UnEncryptedWorkstationsFromCMDB</span></span> <span class="pl-k">-</span>SqlServer SCCM_DB_Server <span class="pl-k">-</span>Database CM_ABC <span class="pl-k">-</span>IntergratedSecurity).ComputerName

foreach (<span class="pl-vo">$workstation</span> <span class="pl-k">in</span> <span class="pl-vo">$unEncryptedWorkStations</span>)
{
<span class="pl-c">    # do things to Enforce BitLocker....</span>
}</pre></div>

<p><strong>UPDATE</strong></p>

<p>I have added a second script in the .\Scripts Directory called Enforce-Bde.ps1 that has a full enforcement and logging, just sent the params for your Logs Directory and for your ConfigMgr SQL Server.  You need to enable BitLockerDrive status in your ConfigMgr Client Settings to use this Script.</p>

<div class="highlight highlight-PowerShell"><pre><span class="pl-c"># Globals</span>

<span class="pl-vo">$SqlServer</span> <span class="pl-k">=</span> [String]::Empty
<span class="pl-vo">$CCMDatabase</span> <span class="pl-k">=</span> [String]::Empty

<span class="pl-k">if</span> ([String]::IsNullOrEmpty(<span class="pl-vo">$SqlServer</span>) <span class="pl-k">-</span><span class="pl-k">or</span> [String]::IsNullOrEmpty(<span class="pl-vo">$CCMDatabase</span>))
{
    throw <span class="pl-s1"><span class="pl-pds">"</span>You must provide the CCM SqlServerName and Database to use this script<span class="pl-pds">"</span></span>
    <span class="pl-k">exit</span>
}

<span class="pl-c"># End Globals</span>

<span class="pl-c"># Functions</span>

<span class="pl-c">&lt;#</span>
<span class="pl-c">.SYNOPSIS</span>
<span class="pl-c">    Logs Events to a a logfile.</span>
<span class="pl-c">.DESCRIPTION</span>
<span class="pl-c">    Logs all errors foreach operation to a file.</span>
<span class="pl-c">.INPUT</span>
<span class="pl-c">    System.String</span>
<span class="pl-c">.OUTPUT</span>
<span class="pl-c">    None.</span>
<span class="pl-c">.EXAMPLE</span>
<span class="pl-c">    Write-LogEntry -Path C:\My.log -Event "MyEvent: Event"</span>
<span class="pl-c">#&gt;</span>
Function <span class="pl-k"><span class="pl-k">Write-LogEntry</span></span>
{
    [CmdletBinding()]
    [OutputType([Void])]
    Param
    (
<span class="pl-c">        # Path, Type string, File path to the log.</span>
        [Parameter(<span class="pl-vpf">Mandatory</span> <span class="pl-k">=</span> <span class="pl-vo">$true</span>)]
        [string]
        <span class="pl-vo">$Path</span>,

<span class="pl-c">        # Event, Type string, Event entry to append to the log.</span>
        [parameter(<span class="pl-vpf">Mandatory</span> <span class="pl-k">=</span> <span class="pl-vo">$true</span>,
                    <span class="pl-vpf">ValueFromPipeLineByPropertyName</span> <span class="pl-k">=</span> <span class="pl-vo">$true</span>)]
        [string[]]
        <span class="pl-vo">$Event</span>
    )

    <span class="pl-k"><span class="pl-k">Add-Content</span></span> <span class="pl-vo">$Path</span> <span class="pl-k">-</span>Value ((<span class="pl-k"><span class="pl-k">Get-Date</span></span>).ToLongDateString()<span class="pl-k">+</span><span class="pl-s1"><span class="pl-pds">"</span> <span class="pl-pds">"</span></span><span class="pl-k">+</span>(<span class="pl-k"><span class="pl-k">Get-Date</span></span>).ToLongTimeString()<span class="pl-k">+</span><span class="pl-s1"><span class="pl-pds">"</span>: <span class="pl-pds">"</span></span><span class="pl-k">+</span><span class="pl-vo">$Event</span>)
}

<span class="pl-c"># End Functions</span>

<span class="pl-c"># Main</span>

<span class="pl-k"><span class="pl-k">Import-Module</span></span> HPTPMAndBitLocker
<span class="pl-vo">$password</span> <span class="pl-k">=</span> powershell <span class="pl-s1"><span class="pl-pds">"</span>. .\New-RandomPassword.ps1; New-RandomPassword -Length 14 -Lowercase -Uppercase -Numbers<span class="pl-pds">"</span></span>
<span class="pl-vo">$log</span> <span class="pl-k">=</span> <span class="pl-s1"><span class="pl-pds">"</span>.\Logs\$(Get-Date -Format yyyyMMdd)_Enforce-BDE.ps1.log<span class="pl-pds">"</span></span>
[String[]]<span class="pl-vo">$unEncryptedWorkStations</span> <span class="pl-k">=</span> (<span class="pl-k"><span class="pl-k">Get-UnEncryptedWorkstationsFromCCMDB</span></span> <span class="pl-k">-</span>SqlServer <span class="pl-vo">$SqlServer</span> <span class="pl-k">-</span>Database <span class="pl-vo">$CCMDatabase</span> <span class="pl-k">-</span>IntergratedSecurity).ComputerName

<span class="pl-k"><span class="pl-k">Write-LogEntry</span></span> <span class="pl-k">-</span>Path <span class="pl-vo">$log</span> <span class="pl-k">-</span>Event <span class="pl-s1"><span class="pl-pds">"</span>####################################<span class="pl-pds">"</span></span>
<span class="pl-k"><span class="pl-k">Write-LogEntry</span></span> <span class="pl-k">-</span>Path <span class="pl-vo">$log</span> <span class="pl-k">-</span>Event <span class="pl-s1"><span class="pl-pds">"</span>##### START OF ENFORCEMENT RUN #####<span class="pl-pds">"</span></span>
<span class="pl-k"><span class="pl-k">Write-LogEntry</span></span> <span class="pl-k">-</span>Path <span class="pl-vo">$log</span> <span class="pl-k">-</span>Event <span class="pl-s1"><span class="pl-pds">"</span>####################################<span class="pl-pds">"</span></span>
<span class="pl-k"><span class="pl-k">Write-LogEntry</span></span> <span class="pl-k">-</span>Path <span class="pl-vo">$log</span> <span class="pl-k">-</span>Event (<span class="pl-s1"><span class="pl-pds">"</span>Total Number of Unencrypted Workstations: $($unEncryptedWorkStations.Length)<span class="pl-pds">"</span></span>)

foreach (<span class="pl-vo">$computer</span> <span class="pl-k">in</span> <span class="pl-vo">$unEncryptedWorkStations</span>)
{
    <span class="pl-k"><span class="pl-k">Write-LogEntry</span></span> <span class="pl-k">-</span>Path <span class="pl-vo">$log</span> <span class="pl-k">-</span>Event <span class="pl-s1"><span class="pl-pds">"</span>Attempting to ping $computer...<span class="pl-pds">"</span></span>

    <span class="pl-k">if</span> (<span class="pl-k">-not</span>(<span class="pl-k"><span class="pl-k">Test-Connection</span></span> <span class="pl-vo">$computer</span> <span class="pl-k">-</span>Count <span class="pl-c1">1</span> <span class="pl-k">-</span>ErrorAction SilentlyContinue))
    {
        <span class="pl-k"><span class="pl-k">Write-LogEntry</span></span> <span class="pl-k">-</span>Path <span class="pl-vo">$log</span> <span class="pl-k">-</span>Event <span class="pl-vo">$error</span>[<span class="pl-c1">0</span>].ToString()
    }
    <span class="pl-k">else</span>
    {
        <span class="pl-k"><span class="pl-k">Write-LogEntry</span></span> <span class="pl-k">-</span>Path <span class="pl-vo">$log</span> <span class="pl-k">-</span>Event <span class="pl-s1"><span class="pl-pds">"</span>Successfully contacted $computer.<span class="pl-pds">"</span></span>

        <span class="pl-k"><span class="pl-k">Write-LogEntry</span></span> <span class="pl-k">-</span>Path <span class="pl-vo">$log</span> <span class="pl-k">-</span>Event <span class="pl-s1"><span class="pl-pds">"</span>Testing for TrueCrypt Disk Encryption on $computer...<span class="pl-pds">"</span></span>
        <span class="pl-k">if</span> (<span class="pl-k"><span class="pl-k">Test-Path</span></span> <span class="pl-s1"><span class="pl-pds">"</span>$env:ProgramData\TrueCrypt\Original System Loader<span class="pl-pds">"</span></span>)
        {
            <span class="pl-vo">$SMSCli</span> <span class="pl-k">=</span> [WmiClass]<span class="pl-s1"><span class="pl-pds">"</span>\\$computer\root\ccm:SMS_Client<span class="pl-pds">"</span></span>
            <span class="pl-vo">$SMSCli</span>.TriggerSchedule(<span class="pl-s1"><span class="pl-pds">"</span>{00000000-0000-0000-0000-000000000002}<span class="pl-pds">"</span></span>) <span class="pl-k">|</span> <span class="pl-k"><span class="pl-k">Out-Null</span></span>
            <span class="pl-k"><span class="pl-k">Write-LogEntry</span></span> <span class="pl-k">-</span>Path <span class="pl-vo">$log</span> <span class="pl-k">-</span>Event <span class="pl-s1"><span class="pl-pds">"</span>Computer is fully encrypted with TrueCrypt Full Disk Encryption, triggering ccm software inventory cycle for $computer...<span class="pl-pds">"</span></span>
            <span class="pl-k">break</span>
        }
        <span class="pl-k">else</span>
        {
            <span class="pl-k"><span class="pl-k">Write-LogEntry</span></span> <span class="pl-k">-</span>Path <span class="pl-vo">$log</span> <span class="pl-k">-</span>Event <span class="pl-s1"><span class="pl-pds">"</span>TrueCrypt Disk Encryption not detected on $computer...<span class="pl-pds">"</span></span>
        }
        <span class="pl-k"><span class="pl-k">Write-LogEntry</span></span> <span class="pl-k">-</span>Path <span class="pl-vo">$log</span> <span class="pl-k">-</span>Event <span class="pl-s1"><span class="pl-pds">"</span>Retrieving TPM status for $computer...<span class="pl-pds">"</span></span>
        <span class="pl-k">try</span>
        {
            <span class="pl-k"><span class="pl-k">Write-LogEntry</span></span> <span class="pl-k">-</span>Path <span class="pl-vo">$log</span> <span class="pl-k">-</span>Event (<span class="pl-s1"><span class="pl-pds">"</span>TPM Propoerly Configured: $(Test-HPTPMEnabledAndActivated -ComputerName $computer)<span class="pl-pds">"</span></span>) 
        }
        catch
        {
            <span class="pl-k"><span class="pl-k">Write-LogEntry</span></span> <span class="pl-k">-</span>Path <span class="pl-vo">$log</span> <span class="pl-k">-</span>Event <span class="pl-vo">$error</span>[<span class="pl-c1">0</span>].ToString()
            Continue
        }

        <span class="pl-k">if</span> (<span class="pl-k">-not</span> (<span class="pl-k"><span class="pl-k">Test-HPTPMEnabledAndActivated</span></span> <span class="pl-k">-</span>ComputerName <span class="pl-vo">$computer</span>))
        {
            <span class="pl-k"><span class="pl-k">Write-LogEntry</span></span> <span class="pl-k">-</span>Path <span class="pl-vo">$log</span> <span class="pl-k">-</span>Event <span class="pl-s1"><span class="pl-pds">"</span>TPM is not properly configured on $computer.<span class="pl-pds">"</span></span>
            <span class="pl-k"><span class="pl-k">Write-LogEntry</span></span> <span class="pl-k">-</span>Path <span class="pl-vo">$log</span> <span class="pl-k">-</span>Event <span class="pl-s1"><span class="pl-pds">"</span>Retrieving setup password state on $computer...<span class="pl-pds">"</span></span>
            <span class="pl-k">try</span>
            {
                <span class="pl-k">if</span> (<span class="pl-k">-not</span>(<span class="pl-k"><span class="pl-k">Get-HPBiosSetupPasswordIsSet</span></span> <span class="pl-k">-</span>ComputerName <span class="pl-vo">$computer</span>))
                {
                    <span class="pl-k"><span class="pl-k">Write-LogEntry</span></span> <span class="pl-k">-</span>Path <span class="pl-vo">$log</span> <span class="pl-k">-</span>Event <span class="pl-s1"><span class="pl-pds">"</span>Setup password is set: False<span class="pl-pds">"</span></span>
                    <span class="pl-k"><span class="pl-k">Write-LogEntry</span></span> <span class="pl-k">-</span>Path <span class="pl-vo">$log</span> <span class="pl-k">-</span>Event (<span class="pl-s1"><span class="pl-pds">"</span>Generating password: <span class="pl-pds">"</span></span> <span class="pl-k">+</span> (<span class="pl-vo">$password</span> <span class="pl-k">=</span> powershell <span class="pl-s1"><span class="pl-pds">"</span>. .\Scripts\New-RandomPassword.ps1; New-RandomPassword -Length 14 -Lowercase -Uppercase -Numbers<span class="pl-pds">"</span></span>))
                    <span class="pl-k"><span class="pl-k">Set-HPBiosSetupPassword</span></span> <span class="pl-k">-</span>ComputerName <span class="pl-vo">$computer</span> <span class="pl-k">-</span>NewPassword <span class="pl-vo">$password</span> <span class="pl-k">|</span> <span class="pl-k">%</span>{ <span class="pl-k"><span class="pl-k">Write-LogEntry</span></span> <span class="pl-k">-</span>Path <span class="pl-vo">$log</span> <span class="pl-k">-</span>Event <span class="pl-vo">$_</span> }
                }
                <span class="pl-k"><span class="pl-k">Write-LogEntry</span></span> <span class="pl-k">-</span>Path <span class="pl-vo">$log</span> <span class="pl-k">-</span>Event <span class="pl-s1"><span class="pl-pds">"</span>Setup password is set: True<span class="pl-pds">"</span></span>
                <span class="pl-k"><span class="pl-k">Invoke-HPTPM</span></span> <span class="pl-k">-</span>ComputerName <span class="pl-vo">$computer</span> <span class="pl-k">-</span>Password <span class="pl-vo">$password</span> <span class="pl-k">|</span> <span class="pl-k">%</span>{ <span class="pl-k"><span class="pl-k">Write-LogEntry</span></span> <span class="pl-k">-</span>Path <span class="pl-vo">$log</span> <span class="pl-k">-</span>Event <span class="pl-vo">$_</span> }
                <span class="pl-k"><span class="pl-k">Write-LogEntry</span></span> <span class="pl-k">-</span>Path <span class="pl-vo">$log</span> <span class="pl-k">-</span>Event <span class="pl-s1"><span class="pl-pds">"</span>Removing Setup password from $computer...<span class="pl-pds">"</span></span>
                <span class="pl-k"><span class="pl-k">Set-HPBiosSetupPassword</span></span> <span class="pl-k">-</span>ComputerName <span class="pl-vo">$computer</span> <span class="pl-k">-</span>NewPassword <span class="pl-s1"><span class="pl-pds">"</span> <span class="pl-pds">"</span></span> <span class="pl-k">-</span>CurrentPassword <span class="pl-vo">$password</span> <span class="pl-k">|</span> <span class="pl-k">%</span>{ <span class="pl-k"><span class="pl-k">Write-LogEntry</span></span> <span class="pl-k">-</span>Path <span class="pl-vo">$log</span> <span class="pl-k">-</span>Event <span class="pl-vo">$_</span> }
                <span class="pl-k"><span class="pl-k">Write-LogEntry</span></span> <span class="pl-k">-</span>Path <span class="pl-vo">$log</span> <span class="pl-k">-</span>Event <span class="pl-s1"><span class="pl-pds">"</span>System reboot required to complete TPM configuration.  BitLocker will be enforced on next run after reboot.<span class="pl-pds">"</span></span>
            }
            catch
            {
                <span class="pl-k"><span class="pl-k">Write-LogEntry</span></span> <span class="pl-k">-</span>Path <span class="pl-vo">$log</span> <span class="pl-k">-</span>Event <span class="pl-vo">$error</span>[<span class="pl-c1">0</span>].ToString()
                Continue
            }
        }
        <span class="pl-k">else</span>
        {
            <span class="pl-k"><span class="pl-k">Write-LogEntry</span></span> <span class="pl-k">-</span>Path <span class="pl-vo">$log</span> <span class="pl-k">-</span>Event <span class="pl-s1"><span class="pl-pds">"</span>TPM is properly configured on $computer.<span class="pl-pds">"</span></span>
            <span class="pl-k"><span class="pl-k">Write-LogEntry</span></span> <span class="pl-k">-</span>Path <span class="pl-vo">$log</span> <span class="pl-k">-</span>Event <span class="pl-s1"><span class="pl-pds">"</span>Retrieving BitLocker status on $computer...<span class="pl-pds">"</span></span>
            <span class="pl-k"><span class="pl-k">Write-LogEntry</span></span> <span class="pl-k">-</span>Path <span class="pl-vo">$log</span> <span class="pl-k">-</span>Event (<span class="pl-s1"><span class="pl-pds">"</span>Protection: $((Get-BitLockerStatus -ComputerName $computer).Protection)<span class="pl-pds">"</span></span>)
            <span class="pl-k"><span class="pl-k">Write-LogEntry</span></span> <span class="pl-k">-</span>Path <span class="pl-vo">$log</span> <span class="pl-k">-</span>Event (<span class="pl-s1"><span class="pl-pds">"</span>State: $((Get-BitLockerStatus -ComputerName $computer).State)<span class="pl-pds">"</span></span>)
            <span class="pl-k"><span class="pl-k">Write-LogEntry</span></span> <span class="pl-k">-</span>Path <span class="pl-vo">$log</span> <span class="pl-k">-</span>Event (<span class="pl-s1"><span class="pl-pds">"</span>Percentage: $((Get-BitLockerStatus -ComputerName $computer).Percentage)<span class="pl-pds">"</span></span>)
            <span class="pl-k">if</span> ((<span class="pl-k"><span class="pl-k">Get-BitLockerStatus</span></span> <span class="pl-k">-</span>ComputerName <span class="pl-vo">$computer</span>).Protection <span class="pl-k">-</span>eq <span class="pl-s1"><span class="pl-pds">"</span>ProtectionOn<span class="pl-pds">"</span></span>)
            {
                <span class="pl-vo">$SMSCli</span> <span class="pl-k">=</span> [WmiClass]<span class="pl-s1"><span class="pl-pds">"</span>\\$computer\root\ccm:SMS_Client<span class="pl-pds">"</span></span>
                <span class="pl-vo">$SMSCli</span>.TriggerSchedule(<span class="pl-s1"><span class="pl-pds">"</span>{00000000-0000-0000-0000-000000000001}<span class="pl-pds">"</span></span>) <span class="pl-k">|</span> <span class="pl-k"><span class="pl-k">Out-Null</span></span>
                <span class="pl-k"><span class="pl-k">Write-LogEntry</span></span> <span class="pl-k">-</span>Path <span class="pl-vo">$log</span> <span class="pl-k">-</span>Event <span class="pl-s1"><span class="pl-pds">"</span>Computer is fully encrypted and protection is on, triggering ccm hardware inventory cycle for $computer...<span class="pl-pds">"</span></span>
            }
            elseif ((<span class="pl-k"><span class="pl-k">Get-BitLockerStatus</span></span> <span class="pl-k">-</span>ComputerName <span class="pl-vo">$computer</span>).State <span class="pl-k">-ne</span> <span class="pl-s1"><span class="pl-pds">"</span>EncryptionInProgress<span class="pl-pds">"</span></span>)
            {
                <span class="pl-k"><span class="pl-k">Write-LogEntry</span></span> <span class="pl-k">-</span>Path <span class="pl-vo">$log</span> <span class="pl-k">-</span>Event <span class="pl-s1"><span class="pl-pds">"</span>Invoking BitLocker drive encryption on $computer.<span class="pl-pds">"</span></span>

                <span class="pl-k"><span class="pl-k">Invoke-BitLockerWithTPMAndNumricalKeyProtectors</span></span> <span class="pl-k">-</span>ComputerName <span class="pl-vo">$computer</span> <span class="pl-k">-</span>ADKeyBackup <span class="pl-k">|</span> <span class="pl-k"><span class="pl-k">Out-Null</span></span>

                <span class="pl-k"><span class="pl-k">Write-LogEntry</span></span> <span class="pl-k">-</span>Path <span class="pl-vo">$log</span> <span class="pl-k">-</span>Event (<span class="pl-s1"><span class="pl-pds">"</span>Protection: $((Get-BitLockerStatus -ComputerName $computer).Protection)<span class="pl-pds">"</span></span>)
                <span class="pl-k"><span class="pl-k">Write-LogEntry</span></span> <span class="pl-k">-</span>Path <span class="pl-vo">$log</span> <span class="pl-k">-</span>Event (<span class="pl-s1"><span class="pl-pds">"</span>State: $((Get-BitLockerStatus -ComputerName $computer).State)<span class="pl-pds">"</span></span>)
                <span class="pl-k"><span class="pl-k">Write-LogEntry</span></span> <span class="pl-k">-</span>Path <span class="pl-vo">$log</span> <span class="pl-k">-</span>Event (<span class="pl-s1"><span class="pl-pds">"</span>Percentage: $((Get-BitLockerStatus -ComputerName $computer).Percentage)<span class="pl-pds">"</span></span>)
            }
        }
    }
}

<span class="pl-k"><span class="pl-k">Write-LogEntry</span></span> <span class="pl-k">-</span>Path <span class="pl-vo">$log</span> <span class="pl-k">-</span>Event <span class="pl-s1"><span class="pl-pds">"</span>##################################<span class="pl-pds">"</span></span>
<span class="pl-k"><span class="pl-k">Write-LogEntry</span></span> <span class="pl-k">-</span>Path <span class="pl-vo">$log</span> <span class="pl-k">-</span>Event <span class="pl-s1"><span class="pl-pds">"</span>##### END OF ENFORCEMENT RUN #####<span class="pl-pds">"</span></span>
<span class="pl-k"><span class="pl-k">Write-LogEntry</span></span> <span class="pl-k">-</span>Path <span class="pl-vo">$log</span> <span class="pl-k">-</span>Event <span class="pl-s1"><span class="pl-pds">"</span>##################################<span class="pl-pds">"</span></span>

<span class="pl-c"># End Main</span></pre></div>
      </section>
      <footer>
        <p>This project is maintained by <a href="https://github.com/dotps1">dotps1</a></p>
        <p><small>Hosted on GitHub Pages &mdash; Theme by <a href="https://github.com/orderedlist">orderedlist</a></small></p>
      </footer>
    </div>
    <script src="javascripts/scale.fix.js"></script>
    
  </body>
</html>